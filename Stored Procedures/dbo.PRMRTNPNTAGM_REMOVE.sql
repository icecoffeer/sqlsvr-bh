SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROCEDURE [dbo].[PRMRTNPNTAGM_REMOVE]
(
  @NUM VARCHAR(14),         --单号
  @MSG VARCHAR(255) OUTPUT  --错误信息
)
AS
BEGIN
  DECLARE
    @STAT INT,
    @RET INT
  SELECT @STAT = STAT FROM PRMRTNPNTAGM(NOLOCK) WHERE NUM = @NUM
  IF @STAT <> 0
  BEGIN
    SET @MSG = '协议 ' + @NUM + ' 不是未审核状态，不允许删除!';
    RETURN(1);
  END
  EXEC @RET = PRMRTNPNTAGM_DOREMOVE @NUM, @MSG OUTPUT
  IF @RET <> 0 RETURN(@RET)
  DELETE FROM PRMRTNPNTAGMLOG WHERE NUM = @NUM
  RETURN(0)
END
GO
